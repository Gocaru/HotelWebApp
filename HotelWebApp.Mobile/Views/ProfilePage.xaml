<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:HotelWebApp.Mobile.ViewModels"
             xmlns:converters="clr-namespace:HotelWebApp.Mobile.Converters"
             x:Class="HotelWebApp.Mobile.Views.ProfilePage"
             x:DataType="vm:ProfileViewModel"
             Shell.NavBarIsVisible="True"
             Title="My Profile"
             BackgroundColor="{AppThemeBinding Light=White, Dark=#121212}">

    <ContentPage.Resources>
        <converters:InvertedBoolConverter x:Key="InvertedBoolConverter" />
    </ContentPage.Resources>

    <ScrollView>
        <VerticalStackLayout Spacing="0">

            <!-- HERO SECTION WITH IMAGE BACKGROUND -->
            <Grid RowDefinitions="240">
                <!-- Background Image -->
                <Image Source="hotel_lobby.jpg"
                       Aspect="AspectFill"/>

                <!-- White Overlay -->
                <BoxView BackgroundColor="White"
                         Opacity="0.70"/>

                <!-- Content -->
                <VerticalStackLayout VerticalOptions="Center" 
                                     Spacing="15"
                                     Padding="40,0">

                    <!-- Profile Photo with Edit Button -->
                    <Grid WidthRequest="90" HeightRequest="90">
                        <Border StrokeThickness="3"
                                Stroke="#1E3A8A"
                                StrokeShape="RoundRectangle 45"
                                Padding="0"
                                WidthRequest="90"
                                HeightRequest="90">
                            <Border.Shadow>
                                <Shadow Brush="Black" Opacity="0.1" Radius="8" Offset="0,2"/>
                            </Border.Shadow>
                            <Image Source="{Binding Profile.ProfilePictureUrl}"
                                   Aspect="AspectFill"/>
                        </Border>

                        <!-- Edit Photo Button -->
                        <Border StrokeThickness="0"
                                StrokeShape="RoundRectangle 16"
                                Padding="8"
                                BackgroundColor="#1E3A8A"
                                VerticalOptions="End"
                                HorizontalOptions="End"
                                WidthRequest="32"
                                HeightRequest="32">
                            <Border.Shadow>
                                <Shadow Brush="Black" Opacity="0.2" Radius="4" Offset="0,2"/>
                            </Border.Shadow>
                            <Border.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding ChangePhotoCommand}"/>
                            </Border.GestureRecognizers>
                            <Label Text="âœŽ"
                                   FontSize="14"
                                   TextColor="White"
                                   HorizontalOptions="Center"
                                   VerticalOptions="Center"/>
                        </Border>
                    </Grid>

                    <!-- Name and Email -->
                    <Label Text="{Binding Profile.FullName}"
                           FontSize="22"
                           FontAttributes="Bold"
                           TextColor="#1E3A8A"
                           HorizontalTextAlignment="Center"/>

                    <Label Text="{Binding Profile.Email}"
                           FontSize="14"
                           TextColor="#6B7280"
                           HorizontalTextAlignment="Center"/>

                </VerticalStackLayout>
            </Grid>

            <!-- CONTENT -->
            <VerticalStackLayout Padding="40,30"
                                 Spacing="25">

                <!-- STATISTICS CARDS -->
                <Grid ColumnDefinitions="*,*,*"
                      ColumnSpacing="12">

                    <!-- Total Reservations -->
                    <Border Grid.Column="0"
                            StrokeThickness="1"
                            Stroke="{AppThemeBinding Light=#E5E7EB, Dark=#374151}"
                            StrokeShape="RoundRectangle 12"
                            Padding="12"
                            BackgroundColor="{AppThemeBinding Light=#F9FAFB, Dark=#1F2937}">
                        <VerticalStackLayout Spacing="4">
                            <Label Text="{Binding Profile.TotalReservations}"
                                   FontSize="24"
                                   FontAttributes="Bold"
                                   TextColor="{AppThemeBinding Light=#1E3A8A, Dark=#60A5FA}"
                                   HorizontalOptions="Center"/>
                            <Label Text="All Stays"
                                   FontSize="10"
                                   FontAttributes="Bold"
                                   TextColor="{AppThemeBinding Light=#6B7280, Dark=#9CA3AF}"
                                   HorizontalOptions="Center"/>
                        </VerticalStackLayout>
                    </Border>

                    <!-- Completed -->
                    <Border Grid.Column="1"
                            StrokeThickness="1"
                            Stroke="{AppThemeBinding Light=#E5E7EB, Dark=#374151}"
                            StrokeShape="RoundRectangle 12"
                            Padding="12"
                            BackgroundColor="{AppThemeBinding Light=#F9FAFB, Dark=#1F2937}">
                        <VerticalStackLayout Spacing="4">
                            <Label Text="{Binding Profile.CompletedStays}"
                                   FontSize="24"
                                   FontAttributes="Bold"
                                   TextColor="#059669"
                                   HorizontalOptions="Center"/>
                            <Label Text="Past Stays"
                                   FontSize="10"
                                   FontAttributes="Bold"
                                   TextColor="{AppThemeBinding Light=#6B7280, Dark=#9CA3AF}"
                                   HorizontalOptions="Center"/>
                        </VerticalStackLayout>
                    </Border>

                    <!-- Upcoming -->
                    <Border Grid.Column="2"
                            StrokeThickness="1"
                            Stroke="{AppThemeBinding Light=#E5E7EB, Dark=#374151}"
                            StrokeShape="RoundRectangle 12"
                            Padding="12"
                            BackgroundColor="{AppThemeBinding Light=#F9FAFB, Dark=#1F2937}">
                        <VerticalStackLayout Spacing="4">
                            <Label Text="{Binding Profile.UpcomingReservations}"
                                   FontSize="24"
                                   FontAttributes="Bold"
                                   TextColor="#F59E0B"
                                   HorizontalOptions="Center"/>
                            <Label Text="Upcoming"
                                   FontSize="10"
                                   FontAttributes="Bold"
                                   TextColor="{AppThemeBinding Light=#6B7280, Dark=#9CA3AF}"
                                   HorizontalOptions="Center"/>
                        </VerticalStackLayout>
                    </Border>
                </Grid>

                <!-- PERSONAL INFORMATION -->
                <VerticalStackLayout Spacing="20">

                    <!-- Header with Edit Button -->
                    <Grid ColumnDefinitions="*,Auto">
                        <Label Grid.Column="0"
                               Text="Personal Information"
                               FontSize="20"
                               FontAttributes="Bold"
                               TextColor="{AppThemeBinding Light=#1E3A8A, Dark=#60A5FA}"/>

                        <Label Grid.Column="1"
                               Text="Edit"
                               FontSize="14"
                               FontAttributes="Bold"
                               TextColor="{AppThemeBinding Light=#1E3A8A, Dark=#60A5FA}"
                               VerticalOptions="Center"
                               IsVisible="{Binding IsEditing, Converter={StaticResource InvertedBoolConverter}}">
                            <Label.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding ToggleEditCommand}"/>
                            </Label.GestureRecognizers>
                        </Label>

                        <Label Grid.Column="1"
                               Text="Cancel"
                               FontSize="14"
                               FontAttributes="Bold"
                               TextColor="#DC2626"
                               VerticalOptions="Center"
                               IsVisible="{Binding IsEditing}">
                            <Label.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding ToggleEditCommand}"/>
                            </Label.GestureRecognizers>
                        </Label>
                    </Grid>

                    <!-- VIEW MODE -->
                    <VerticalStackLayout Spacing="16"
                                         IsVisible="{Binding IsEditing, Converter={StaticResource InvertedBoolConverter}}">

                        <!-- Full Name -->
                        <VerticalStackLayout Spacing="6">
                            <Label Text="Full Name"
                                   FontSize="12"
                                   FontAttributes="Bold"
                                   TextColor="{AppThemeBinding Light=#6B7280, Dark=#9CA3AF}"/>
                            <Label Text="{Binding Profile.FullName}"
                                   FontSize="16"
                                   TextColor="{AppThemeBinding Light=#1F2937, Dark=#E5E7EB}"/>
                        </VerticalStackLayout>

                        <!-- Phone -->
                        <VerticalStackLayout Spacing="6">
                            <Label Text="Phone Number"
                                   FontSize="12"
                                   FontAttributes="Bold"
                                   TextColor="{AppThemeBinding Light=#6B7280, Dark=#9CA3AF}"/>
                            <Label Text="{Binding Profile.DisplayPhoneNumber}"
                                   FontSize="16"
                                   TextColor="{AppThemeBinding Light=#1F2937, Dark=#E5E7EB}"/>
                        </VerticalStackLayout>

                        <!-- Document -->
                        <VerticalStackLayout Spacing="6">
                            <Label Text="Identification Document"
                                   FontSize="12"
                                   FontAttributes="Bold"
                                   TextColor="{AppThemeBinding Light=#6B7280, Dark=#9CA3AF}"/>
                            <Label Text="{Binding Profile.DisplayDocument}"
                                   FontSize="16"
                                   TextColor="{AppThemeBinding Light=#1F2937, Dark=#E5E7EB}"/>
                        </VerticalStackLayout>
                    </VerticalStackLayout>

                    <!-- EDIT MODE -->
                    <VerticalStackLayout Spacing="16"
                                         IsVisible="{Binding IsEditing}">

                        <!-- Full Name -->
                        <VerticalStackLayout Spacing="8">
                            <Label Text="Full Name *"
                                   FontSize="12"
                                   FontAttributes="Bold"
                                   TextColor="{AppThemeBinding Light=#6B7280, Dark=#9CA3AF}"/>
                            <Border StrokeThickness="1"
                                    Stroke="{AppThemeBinding Light=#E5E7EB, Dark=#374151}"
                                    StrokeShape="RoundRectangle 10"
                                    BackgroundColor="{AppThemeBinding Light=#F9FAFB, Dark=#1F2937}">
                                <Entry Text="{Binding FullName}"
                                       Placeholder="Enter your full name"
                                       FontSize="15"
                                       TextColor="{AppThemeBinding Light=#1F2937, Dark=#E5E7EB}"
                                       PlaceholderColor="{AppThemeBinding Light=#9CA3AF, Dark=#6B7280}"
                                       Margin="12,8"/>
                            </Border>
                        </VerticalStackLayout>

                        <!-- Phone -->
                        <VerticalStackLayout Spacing="8">
                            <Label Text="Phone Number"
                                   FontSize="12"
                                   FontAttributes="Bold"
                                   TextColor="{AppThemeBinding Light=#6B7280, Dark=#9CA3AF}"/>
                            <Border StrokeThickness="1"
                                    Stroke="{AppThemeBinding Light=#E5E7EB, Dark=#374151}"
                                    StrokeShape="RoundRectangle 10"
                                    BackgroundColor="{AppThemeBinding Light=#F9FAFB, Dark=#1F2937}">
                                <Entry Text="{Binding PhoneNumber}"
                                       Placeholder="Enter your phone number"
                                       Keyboard="Telephone"
                                       FontSize="15"
                                       TextColor="{AppThemeBinding Light=#1F2937, Dark=#E5E7EB}"
                                       PlaceholderColor="{AppThemeBinding Light=#9CA3AF, Dark=#6B7280}"
                                       Margin="12,8"/>
                            </Border>
                        </VerticalStackLayout>

                        <!-- Document -->
                        <VerticalStackLayout Spacing="8">
                            <Label Text="Identification Document"
                                   FontSize="12"
                                   FontAttributes="Bold"
                                   TextColor="{AppThemeBinding Light=#6B7280, Dark=#9CA3AF}"/>
                            <Border StrokeThickness="1"
                                    Stroke="{AppThemeBinding Light=#E5E7EB, Dark=#374151}"
                                    StrokeShape="RoundRectangle 10"
                                    BackgroundColor="{AppThemeBinding Light=#F9FAFB, Dark=#1F2937}">
                                <Entry Text="{Binding IdentificationDocument}"
                                       Placeholder="Enter document number"
                                       FontSize="15"
                                       TextColor="{AppThemeBinding Light=#1F2937, Dark=#E5E7EB}"
                                       PlaceholderColor="{AppThemeBinding Light=#9CA3AF, Dark=#6B7280}"
                                       Margin="12,8"/>
                            </Border>
                        </VerticalStackLayout>

                        <!-- Save Button -->
                        <Border StrokeThickness="0"
                                StrokeShape="RoundRectangle 12"
                                Padding="0"
                                HeightRequest="52"
                                BackgroundColor="#1E3A8A"
                                Margin="0,10,0,0">
                            <Border.Shadow>
                                <Shadow Brush="Black" Opacity="0.1" Radius="8" Offset="0,2"/>
                            </Border.Shadow>
                            <Border.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding SaveProfileCommand}"/>
                            </Border.GestureRecognizers>
                            <Label Text="Save Changes"
                                   FontSize="16"
                                   FontAttributes="Bold"
                                   TextColor="White"
                                   HorizontalTextAlignment="Center"
                                   VerticalTextAlignment="Center"/>
                        </Border>
                    </VerticalStackLayout>

                </VerticalStackLayout>

                <!-- Divider -->
                <BoxView HeightRequest="1"
                         Color="{AppThemeBinding Light=#E5E7EB, Dark=#374151}"
                         Margin="0,10"/>

                <!-- QUICK ACTIONS -->
                <VerticalStackLayout Spacing="12">

                    <!-- View Reservations -->
                    <Border StrokeThickness="1"
                            Stroke="{AppThemeBinding Light=#E5E7EB, Dark=#374151}"
                            StrokeShape="RoundRectangle 12"
                            Padding="18"
                            BackgroundColor="{AppThemeBinding Light=White, Dark=#1F2937}">
                        <Border.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding ViewReservationsCommand}"/>
                        </Border.GestureRecognizers>
                        <Grid ColumnDefinitions="*,Auto">
                            <Label Grid.Column="0"
                                   Text="View All Reservations"
                                   FontSize="15"
                                   FontAttributes="Bold"
                                   TextColor="{AppThemeBinding Light=#1F2937, Dark=#E5E7EB}"
                                   VerticalOptions="Center"/>
                            <Label Grid.Column="1"
                                   Text="â€º"
                                   FontSize="24"
                                   TextColor="{AppThemeBinding Light=#9CA3AF, Dark=#6B7280}"
                                   VerticalOptions="Center"/>
                        </Grid>
                    </Border>

                    <!-- Change Password -->
                    <Border StrokeThickness="1"
                            Stroke="{AppThemeBinding Light=#E5E7EB, Dark=#374151}"
                            StrokeShape="RoundRectangle 12"
                            Padding="18"
                            BackgroundColor="{AppThemeBinding Light=White, Dark=#1F2937}">
                        <Border.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding NavigateToChangePasswordCommand}"/>
                        </Border.GestureRecognizers>
                        <Grid ColumnDefinitions="*,Auto">
                            <Label Grid.Column="0"
                                   Text="Change Password"
                                   FontSize="15"
                                   FontAttributes="Bold"
                                   TextColor="{AppThemeBinding Light=#1F2937, Dark=#E5E7EB}"
                                   VerticalOptions="Center"/>
                            <Label Grid.Column="1"
                                   Text="â€º"
                                   FontSize="24"
                                   TextColor="{AppThemeBinding Light=#9CA3AF, Dark=#6B7280}"
                                   VerticalOptions="Center"/>
                        </Grid>
                    </Border>
                </VerticalStackLayout>

                <!-- Loading Indicator -->
                <ActivityIndicator IsRunning="{Binding IsBusy}"
                                   IsVisible="{Binding IsBusy}"
                                   Color="#1E3A8A"
                                   HeightRequest="50"
                                   Margin="0,20,0,20"/>

            </VerticalStackLayout>

        </VerticalStackLayout>
    </ScrollView>

</ContentPage>