<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:HotelWebApp.Mobile.ViewModels"
             xmlns:converters="clr-namespace:HotelWebApp.Mobile.Converters"
             x:Class="HotelWebApp.Mobile.Views.ProfilePage"
             x:DataType="vm:ProfileViewModel"
             Shell.NavBarIsVisible="True"
             Title="My Profile"
             BackgroundColor="White">

    <ContentPage.Resources>
        <converters:InvertedBoolConverter x:Key="InvertedBoolConverter" />
    </ContentPage.Resources>

    <ScrollView>
        <VerticalStackLayout Spacing="0">

            <!-- HERO HEADER -->
            <Grid RowDefinitions="220" Padding="0">
                <!-- Background Gradient -->
                <Grid.Background>
                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                        <GradientStop Color="#1E3A8A" Offset="0.0" />
                        <GradientStop Color="#3B82F6" Offset="1.0" />
                    </LinearGradientBrush>
                </Grid.Background>

                <!-- Content -->
                <VerticalStackLayout VerticalOptions="Center" 
                         HorizontalOptions="Center" 
                         Spacing="12">

                    <!-- Profile Photo with Camera Button -->
                    <Grid WidthRequest="80" HeightRequest="80">
                        <Frame WidthRequest="80"
                   HeightRequest="80"
                   CornerRadius="40"
                   Padding="0"
                   HasShadow="True"
                   HorizontalOptions="Center"
                   BorderColor="White">
                            <Image Source="{Binding Profile.ProfilePictureUrl}"
                       Aspect="AspectFill"/>
                        </Frame>

                        <!-- Camera Button -->
                        <Frame CornerRadius="18"
                   Padding="0"
                   HasShadow="True"
                   BackgroundColor="#D4AF37"
                   VerticalOptions="End"
                   HorizontalOptions="End"
                   WidthRequest="36"
                   HeightRequest="36"
                   Margin="0,0,5,5">
                            <Label Text="ðŸ“·"
                       FontSize="18"
                       HorizontalOptions="Center"
                       VerticalOptions="Center"/>
                            <Frame.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding ChangePhotoCommand}" />
                            </Frame.GestureRecognizers>
                        </Frame>
                    </Grid>

                    <!-- Name and Email -->
                    <Label Text="{Binding Profile.FullName}"
               FontSize="24"
               FontAttributes="Bold"
               TextColor="White"
               HorizontalOptions="Center"/>

                    <Label Text="{Binding Profile.Email}"
               FontSize="14"
               TextColor="White"
               Opacity="0.8"
               HorizontalOptions="Center"/>
                </VerticalStackLayout>
            </Grid>

            <!-- STATISTICS CARDS -->
            <Grid ColumnDefinitions="*,*,*"
                  ColumnSpacing="12"
                  Padding="20"
                  Margin="0,-30,0,0">

                <!-- Total Reservations -->
                <Frame Grid.Column="0"
                       Padding="15"
                       BackgroundColor="White"
                       BorderColor="#E5E7EB"
                       CornerRadius="12"
                       HasShadow="True">
                    <VerticalStackLayout Spacing="5">
                        <Label Text="{Binding Profile.TotalReservations}"
                               FontSize="28"
                               FontAttributes="Bold"
                               TextColor="#1E3A8A"
                               HorizontalOptions="Center"/>
                        <Label Text="All Stays"
                               FontSize="11"
                               TextColor="#6B7280"
                               HorizontalOptions="Center"/>
                    </VerticalStackLayout>
                </Frame>

                <!-- Completed -->
                <Frame Grid.Column="1"
                       Padding="15"
                       BackgroundColor="White"
                       BorderColor="#E5E7EB"
                       CornerRadius="12"
                       HasShadow="True">
                    <VerticalStackLayout Spacing="5">
                        <Label Text="{Binding Profile.CompletedStays}"
                               FontSize="28"
                               FontAttributes="Bold"
                               TextColor="#059669"
                               HorizontalOptions="Center"/>
                        <Label Text="Past Stays"
                               FontSize="11"
                               TextColor="#6B7280"
                               HorizontalOptions="Center"/>
                    </VerticalStackLayout>
                </Frame>

                <!-- Upcoming -->
                <Frame Grid.Column="2"
                       Padding="15"
                       BackgroundColor="White"
                       BorderColor="#E5E7EB"
                       CornerRadius="12"
                       HasShadow="True">
                    <VerticalStackLayout Spacing="5">
                        <Label Text="{Binding Profile.UpcomingReservations}"
                               FontSize="28"
                               FontAttributes="Bold"
                               TextColor="#F59E0B"
                               HorizontalOptions="Center"/>
                        <Label Text="Upcoming"
                               FontSize="11"
                               TextColor="#6B7280"
                               HorizontalOptions="Center"/>
                    </VerticalStackLayout>
                </Frame>
            </Grid>

            <!-- CONTENT AREA -->
            <VerticalStackLayout Padding="20,10,20,20" Spacing="20">

                <!-- PERSONAL INFORMATION CARD -->
                <Frame Padding="20"
                       BackgroundColor="White"
                       BorderColor="#E5E7EB"
                       CornerRadius="12"
                       HasShadow="True">
                    <VerticalStackLayout Spacing="20">

                        <!-- Header with Edit Button -->
                        <Grid ColumnDefinitions="*,Auto">
                            <Label Grid.Column="0"
                                   Text="Personal Information"
                                   FontSize="18"
                                   FontAttributes="Bold"
                                   TextColor="#1F2937"/>

                            <Button Grid.Column="1"
                                    Text="Edit"
                                    Command="{Binding ToggleEditCommand}"
                                    BackgroundColor="Transparent"
                                    TextColor="#1E3A8A"
                                    FontSize="14"
                                    FontAttributes="Bold"
                                    Padding="12,0"
                                    IsVisible="{Binding IsEditing, Converter={StaticResource InvertedBoolConverter}}" />

                            <Button Grid.Column="1"
                                    Text="Cancel"
                                    Command="{Binding ToggleEditCommand}"
                                    BackgroundColor="Transparent"
                                    TextColor="#DC2626"
                                    FontSize="14"
                                    FontAttributes="Bold"
                                    Padding="12,0"
                                    IsVisible="{Binding IsEditing}" />
                        </Grid>

                        <!-- VIEW MODE -->
                        <VerticalStackLayout Spacing="20"
                                           IsVisible="{Binding IsEditing, Converter={StaticResource InvertedBoolConverter}}">

                            <!-- Full Name -->
                            <VerticalStackLayout Spacing="8">
                                <Label Text="Full Name"
                                       FontSize="12"
                                       FontAttributes="Bold"
                                       TextColor="#6B7280"/>
                                <Label Text="{Binding Profile.FullName}"
                                       FontSize="16"
                                       TextColor="#1F2937"/>
                            </VerticalStackLayout>

                            <!-- Phone -->
                            <VerticalStackLayout Spacing="8">
                                <Label Text="Phone Number"
                                       FontSize="12"
                                       FontAttributes="Bold"
                                       TextColor="#6B7280"/>
                                <Label Text="{Binding Profile.DisplayPhoneNumber}"
                                       FontSize="16"
                                       TextColor="#1F2937"/>
                            </VerticalStackLayout>

                            <!-- Document -->
                            <VerticalStackLayout Spacing="8">
                                <Label Text="Identification Document"
                                       FontSize="12"
                                       FontAttributes="Bold"
                                       TextColor="#6B7280"/>
                                <Label Text="{Binding Profile.DisplayDocument}"
                                       FontSize="16"
                                       TextColor="#1F2937"/>
                            </VerticalStackLayout>
                        </VerticalStackLayout>

                        <!-- EDIT MODE -->
                        <VerticalStackLayout Spacing="18"
                                           IsVisible="{Binding IsEditing}">

                            <!-- Full Name -->
                            <VerticalStackLayout Spacing="8">
                                <Label Text="Full Name *"
                                       FontSize="12"
                                       FontAttributes="Bold"
                                       TextColor="#6B7280"/>
                                <Frame Padding="12"
                                       BackgroundColor="#F9FAFB"
                                       BorderColor="#E5E7EB"
                                       CornerRadius="8"
                                       HasShadow="False">
                                    <Entry Text="{Binding FullName}"
                                           Placeholder="Enter your full name"
                                           FontSize="16"
                                           TextColor="#1F2937"/>
                                </Frame>
                            </VerticalStackLayout>

                            <!-- Phone -->
                            <VerticalStackLayout Spacing="8">
                                <Label Text="Phone Number"
                                       FontSize="12"
                                       FontAttributes="Bold"
                                       TextColor="#6B7280"/>
                                <Frame Padding="12"
                                       BackgroundColor="#F9FAFB"
                                       BorderColor="#E5E7EB"
                                       CornerRadius="8"
                                       HasShadow="False">
                                    <Entry Text="{Binding PhoneNumber}"
                                           Placeholder="Enter your phone number"
                                           Keyboard="Telephone"
                                           FontSize="16"
                                           TextColor="#1F2937"/>
                                </Frame>
                            </VerticalStackLayout>

                            <!-- Document -->
                            <VerticalStackLayout Spacing="8">
                                <Label Text="Identification Document"
                                       FontSize="12"
                                       FontAttributes="Bold"
                                       TextColor="#6B7280"/>
                                <Frame Padding="12"
                                       BackgroundColor="#F9FAFB"
                                       BorderColor="#E5E7EB"
                                       CornerRadius="8"
                                       HasShadow="False">
                                    <Entry Text="{Binding IdentificationDocument}"
                                           Placeholder="Enter document number"
                                           FontSize="16"
                                           TextColor="#1F2937"/>
                                </Frame>
                            </VerticalStackLayout>

                            <!-- Save Button -->
                            <Button Text="Save Changes"
                                    Command="{Binding SaveProfileCommand}"
                                    BackgroundColor="#1E3A8A"
                                    TextColor="White"
                                    CornerRadius="10"
                                    HeightRequest="50"
                                    FontAttributes="Bold"
                                    Margin="0,10,0,0"/>
                        </VerticalStackLayout>

                    </VerticalStackLayout>
                </Frame>

                <!-- QUICK ACTIONS -->
                <VerticalStackLayout Spacing="12">

                    <!-- View Reservations -->
                    <Frame Padding="18"
                           BackgroundColor="White"
                           BorderColor="#E5E7EB"
                           CornerRadius="12"
                           HasShadow="True">
                        <Frame.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding ViewReservationsCommand}"/>
                        </Frame.GestureRecognizers>
                        <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="15">
                            <Frame Grid.Column="0"
                                   Padding="10"
                                   BackgroundColor="#EEF2FF"
                                   BorderColor="Transparent"
                                   CornerRadius="8"
                                   HasShadow="False">
                                <Label Text="ðŸ“…"
                                       FontSize="22"/>
                            </Frame>
                            <Label Grid.Column="1"
                                   Text="View All Reservations"
                                   FontSize="16"
                                   FontAttributes="Bold"
                                   TextColor="#1F2937"
                                   VerticalOptions="Center"/>
                            <Label Grid.Column="2"
                                   Text="â€º"
                                   FontSize="24"
                                   TextColor="#9CA3AF"
                                   VerticalOptions="Center"/>
                        </Grid>
                    </Frame>

                    <!-- Change Password -->
                    <Frame Padding="18"
                           BackgroundColor="White"
                           BorderColor="#E5E7EB"
                           CornerRadius="12"
                           HasShadow="True">
                        <Frame.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding NavigateToChangePasswordCommand}"/>
                        </Frame.GestureRecognizers>
                        <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="15">
                            <Frame Grid.Column="0"
                                   Padding="10"
                                   BackgroundColor="#FEF3C7"
                                   BorderColor="Transparent"
                                   CornerRadius="8"
                                   HasShadow="False">
                                <Label Text="ðŸ”’"
                                       FontSize="22"/>
                            </Frame>
                            <Label Grid.Column="1"
                                   Text="Change Password"
                                   FontSize="16"
                                   FontAttributes="Bold"
                                   TextColor="#1F2937"
                                   VerticalOptions="Center"/>
                            <Label Grid.Column="2"
                                   Text="â€º"
                                   FontSize="24"
                                   TextColor="#9CA3AF"
                                   VerticalOptions="Center"/>
                        </Grid>
                    </Frame>
                </VerticalStackLayout>

            </VerticalStackLayout>

            <!-- Loading Indicator -->
            <ActivityIndicator IsRunning="{Binding IsBusy}"
                             IsVisible="{Binding IsBusy}"
                             Color="#1E3A8A"
                             VerticalOptions="Center"
                             Margin="0,50,0,0"
                             HeightRequest="50" />

        </VerticalStackLayout>
    </ScrollView>

</ContentPage>