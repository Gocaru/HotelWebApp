<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:HotelWebApp.Mobile.ViewModels"
             x:Class="HotelWebApp.Mobile.Views.ActivityDetailPage"
             x:DataType="viewmodels:ActivityDetailViewModel"
             Title="Activity Details"
             BackgroundColor="{AppThemeBinding Light=White, Dark=#121212}">

    <ScrollView>
        <VerticalStackLayout Spacing="0">

            <Grid RowDefinitions="200">
                <Image Source="hotel_lobby.jpg"
                       Aspect="AspectFill"/>

                <BoxView BackgroundColor="White"
                         Opacity="0.70"/>

                <VerticalStackLayout VerticalOptions="Center" 
                                     Spacing="10"
                                     Padding="40,0">

                    <Label Text="Activity Details"
                           FontSize="28"
                           FontAttributes="Bold"
                           TextColor="#1E3A8A"
                           HorizontalTextAlignment="Center"
                           LineHeight="1.2"/>

                    <Label Text="Review details and book your experience"
                           FontSize="14"
                           FontAttributes="Bold"
                           TextColor="#000000"
                           LineHeight="1.4"
                           HorizontalTextAlignment="Center"/>

                </VerticalStackLayout>
            </Grid>

            <VerticalStackLayout Padding="40,30"
                                 Spacing="25">

                <ActivityIndicator IsRunning="{Binding IsBusy}"
                                   IsVisible="{Binding IsBusy}"
                                   Color="#1E3A8A"
                                   HeightRequest="50"/>


                <Frame IsVisible="{Binding ErrorMessage, Converter={StaticResource StringNotEmptyConverter}}"
                       BackgroundColor="#FEE2E2"
                       BorderColor="#EF4444"
                       CornerRadius="12"
                       Padding="20"
                       HasShadow="False">
                    <Label Text="{Binding ErrorMessage}"
                           TextColor="#991B1B"
                           FontSize="14"
                           LineHeight="1.5"/>
                </Frame>

                <Frame IsVisible="{Binding SuccessMessage, Converter={StaticResource StringNotEmptyConverter}}"
                       BackgroundColor="#D1FAE5"
                       BorderColor="#10B981"
                       CornerRadius="12"
                       Padding="20"
                       HasShadow="False">
                    <Label Text="{Binding SuccessMessage}"
                           TextColor="#065F46"
                           FontSize="14"
                           FontAttributes="Bold"
                           LineHeight="1.5"/>
                </Frame>

                <VerticalStackLayout IsVisible="{Binding Activity, Converter={StaticResource ObjectNotNullConverter}}"
                                     Spacing="30">

                    <VerticalStackLayout Spacing="12">
                        <Label Text="{Binding Activity.Name}"
                               FontSize="26"
                               FontAttributes="Bold"
                               TextColor="{AppThemeBinding Light=#1E3A8A, Dark=#60A5FA}"/>

                        <Label Text="{Binding Activity.Description}"
                               FontSize="15"
                               TextColor="{AppThemeBinding Light=#6B7280, Dark=#9CA3AF}"
                               LineBreakMode="WordWrap"
                               LineHeight="1.6"/>
                    </VerticalStackLayout>

                    <Grid ColumnDefinitions="*,*" 
                          ColumnSpacing="15"
                          RowDefinitions="Auto,Auto"
                          RowSpacing="15">

                        <Border Grid.Column="0" Grid.Row="0"
                                StrokeThickness="1"
                                Stroke="{AppThemeBinding Light=#E5E7EB, Dark=#374151}"
                                StrokeShape="RoundRectangle 12"
                                Padding="16"
                                BackgroundColor="{AppThemeBinding Light=#F9FAFB, Dark=#1F2937}">
                            <VerticalStackLayout Spacing="6">
                                <Label Text="Duration"
                                       FontSize="12"
                                       FontAttributes="Bold"
                                       TextColor="{AppThemeBinding Light=#6B7280, Dark=#9CA3AF}"/>
                                <Label Text="{Binding Activity.DisplayDuration}"
                                       FontSize="16"
                                       FontAttributes="Bold"
                                       TextColor="{AppThemeBinding Light=#1F2937, Dark=#E5E7EB}"/>
                            </VerticalStackLayout>
                        </Border>

                        <Border Grid.Column="1" Grid.Row="0"
                                StrokeThickness="1"
                                Stroke="{AppThemeBinding Light=#E5E7EB, Dark=#374151}"
                                StrokeShape="RoundRectangle 12"
                                Padding="16"
                                BackgroundColor="{AppThemeBinding Light=#F9FAFB, Dark=#1F2937}">
                            <VerticalStackLayout Spacing="6">
                                <Label Text="Schedule"
                                       FontSize="12"
                                       FontAttributes="Bold"
                                       TextColor="{AppThemeBinding Light=#6B7280, Dark=#9CA3AF}"/>
                                <Label Text="{Binding Activity.DisplaySchedule}"
                                       FontSize="14"
                                       FontAttributes="Bold"
                                       TextColor="{AppThemeBinding Light=#1F2937, Dark=#E5E7EB}"
                                       LineBreakMode="WordWrap"
                                       MaxLines="2"/>
                            </VerticalStackLayout>
                        </Border>

                        <Border Grid.Column="0" Grid.Row="1"
                                StrokeThickness="1"
                                Stroke="{AppThemeBinding Light=#E5E7EB, Dark=#374151}"
                                StrokeShape="RoundRectangle 12"
                                Padding="16"
                                BackgroundColor="{AppThemeBinding Light=#F9FAFB, Dark=#1F2937}">
                            <VerticalStackLayout Spacing="6">
                                <Label Text="Available"
                                       FontSize="12"
                                       FontAttributes="Bold"
                                       TextColor="{AppThemeBinding Light=#6B7280, Dark=#9CA3AF}"/>
                                <Label Text="{Binding AvailableText}"
                                       FontSize="16"
                                       FontAttributes="Bold"
                                       TextColor="{Binding AvailabilityColor}"/>
                            </VerticalStackLayout>
                        </Border>

                        <Border Grid.Column="1" Grid.Row="1"
                                StrokeThickness="1"
                                Stroke="{AppThemeBinding Light=#E5E7EB, Dark=#374151}"
                                StrokeShape="RoundRectangle 12"
                                Padding="16"
                                BackgroundColor="{AppThemeBinding Light=#F9FAFB, Dark=#1F2937}">
                            <VerticalStackLayout Spacing="6">
                                <Label Text="Price"
                                       FontSize="12"
                                       FontAttributes="Bold"
                                       TextColor="{AppThemeBinding Light=#6B7280, Dark=#9CA3AF}"/>
                                <Label Text="{Binding Activity.FormattedPrice}"
                                       FontSize="20"
                                       FontAttributes="Bold"
                                       TextColor="{AppThemeBinding Light=#1E3A8A, Dark=#60A5FA}"/>
                            </VerticalStackLayout>
                        </Border>
                    </Grid>

                    <BoxView HeightRequest="1"
                             Color="{AppThemeBinding Light=#E5E7EB, Dark=#374151}"/>

                    <VerticalStackLayout Spacing="25">

                        <Label Text="Book This Activity"
                               FontSize="22"
                               FontAttributes="Bold"
                               TextColor="{AppThemeBinding Light=#1E3A8A, Dark=#60A5FA}"/>

                        <VerticalStackLayout Spacing="8">
                            <Label Text="Select Date"
                                   FontSize="14"
                                   FontAttributes="Bold"
                                   TextColor="{AppThemeBinding Light=#6B7280, Dark=#9CA3AF}"/>
                            <Border StrokeThickness="1"
                                    Stroke="{AppThemeBinding Light=#E5E7EB, Dark=#374151}"
                                    StrokeShape="RoundRectangle 12"
                                    Padding="12"
                                    BackgroundColor="{AppThemeBinding Light=#F9FAFB, Dark=#1F2937}">
                                <DatePicker Date="{Binding ScheduledDate}"
                                            MinimumDate="{Binding MinimumDate}"
                                            Format="dd/MM/yyyy"
                                            FontSize="16"
                                            TextColor="{AppThemeBinding Light=#1F2937, Dark=#E5E7EB}"/>
                            </Border>
                        </VerticalStackLayout>

                        <Border IsVisible="{Binding Availability, Converter={StaticResource ObjectNotNullConverter}}"
                                StrokeThickness="1"
                                Stroke="{AppThemeBinding Light=#E5E7EB, Dark=#374151}"
                                StrokeShape="RoundRectangle 12"
                                Padding="16"
                                BackgroundColor="{AppThemeBinding Light=#F9FAFB, Dark=#1F2937}">
                            <Grid ColumnDefinitions="Auto,*">
                                <ActivityIndicator Grid.Column="0"
                                                   IsRunning="{Binding IsCheckingAvailability}"
                                                   IsVisible="{Binding IsCheckingAvailability}"
                                                   Color="#1E3A8A"
                                                   WidthRequest="20"
                                                   HeightRequest="20"
                                                   VerticalOptions="Center"
                                                   Margin="0,0,10,0"/>

                                <VerticalStackLayout Grid.Column="1" 
                                                     Spacing="4"
                                                     IsVisible="{Binding IsCheckingAvailability, Converter={StaticResource InvertedBoolConverter}}">
                                    <Label Text="{Binding Availability.AvailabilityText}"
                                           FontSize="16"
                                           FontAttributes="Bold"
                                           TextColor="{Binding Availability.AvailabilityColor}"/>
                                    <Label Text="{Binding Availability.Date, StringFormat='for {0:dd/MM/yyyy}'}"
                                           FontSize="13"
                                           TextColor="{AppThemeBinding Light=#6B7280, Dark=#9CA3AF}"/>
                                </VerticalStackLayout>
                            </Grid>
                        </Border>

                        <VerticalStackLayout Spacing="12">
                            <Label Text="Number of Participants"
                                   FontSize="14"
                                   FontAttributes="Bold"
                                   TextColor="{AppThemeBinding Light=#6B7280, Dark=#9CA3AF}"/>

                            <Grid ColumnDefinitions="Auto,*,Auto"
                                  ColumnSpacing="15"
                                  VerticalOptions="Center">

                                <Border Grid.Column="0"
                                        StrokeThickness="0"
                                        StrokeShape="RoundRectangle 30"
                                        Padding="0"
                                        BackgroundColor="#1E3A8A"
                                        WidthRequest="60"
                                        HeightRequest="60">
                                    <Border.GestureRecognizers>
                                        <TapGestureRecognizer Command="{Binding DecrementParticipantsCommand}"/>
                                    </Border.GestureRecognizers>
                                    <Label Text="−"
                                           FontSize="28"
                                           FontAttributes="Bold"
                                           TextColor="White"
                                           HorizontalOptions="Center"
                                           VerticalOptions="Center"/>
                                </Border>

                                <Border Grid.Column="1"
                                        StrokeThickness="1"
                                        Stroke="{AppThemeBinding Light=#E5E7EB, Dark=#374151}"
                                        StrokeShape="RoundRectangle 12"
                                        Padding="20"
                                        BackgroundColor="{AppThemeBinding Light=#F9FAFB, Dark=#1F2937}">
                                    <Label Text="{Binding NumberOfParticipants}"
                                           FontSize="32"
                                           FontAttributes="Bold"
                                           TextColor="{AppThemeBinding Light=#1E3A8A, Dark=#60A5FA}"
                                           HorizontalOptions="Center"
                                           VerticalOptions="Center"/>
                                </Border>

                                <Border Grid.Column="2"
                                        StrokeThickness="0"
                                        StrokeShape="RoundRectangle 30"
                                        Padding="0"
                                        BackgroundColor="#1E3A8A"
                                        WidthRequest="60"
                                        HeightRequest="60">
                                    <Border.GestureRecognizers>
                                        <TapGestureRecognizer Command="{Binding IncrementParticipantsCommand}"/>
                                    </Border.GestureRecognizers>
                                    <Label Text="+"
                                           FontSize="28"
                                           FontAttributes="Bold"
                                           TextColor="White"
                                           HorizontalOptions="Center"
                                           VerticalOptions="Center"/>
                                </Border>
                            </Grid>
                        </VerticalStackLayout>

                        <Border StrokeThickness="2"
                                Stroke="{AppThemeBinding Light=#1E3A8A, Dark=#60A5FA}"
                                StrokeShape="RoundRectangle 12"
                                Padding="20"
                                BackgroundColor="{AppThemeBinding Light=#EEF2FF, Dark=#1E3A8A}">
                            <HorizontalStackLayout Spacing="10"
                                                   HorizontalOptions="Center">
                                <Label Text="Total:"
                                       FontSize="18"
                                       TextColor="{AppThemeBinding Light=#1E3A8A, Dark=White}"
                                       VerticalOptions="Center"/>
                                <Label Text="{Binding TotalPrice, StringFormat='€{0:F2}'}"
                                       FontSize="28"
                                       FontAttributes="Bold"
                                       TextColor="{AppThemeBinding Light=#1E3A8A, Dark=White}"
                                       VerticalOptions="Center"/>
                            </HorizontalStackLayout>
                        </Border>

                        <Border StrokeThickness="0"
                                StrokeShape="RoundRectangle 12"
                                Padding="0"
                                HeightRequest="56"
                                BackgroundColor="#1E3A8A">
                            <Border.Shadow>
                                <Shadow Brush="Black" Opacity="0.1" Radius="8" Offset="0,2"/>
                            </Border.Shadow>
                            <Border.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding BookActivityCommand}"/>
                            </Border.GestureRecognizers>
                            <Label Text="Book Activity"
                                   FontSize="18"
                                   FontAttributes="Bold"
                                   TextColor="White"
                                   HorizontalTextAlignment="Center"
                                   VerticalTextAlignment="Center"/>
                            <Border.Triggers>
                                <MultiTrigger TargetType="Border">
                                    <MultiTrigger.Conditions>
                                        <BindingCondition Binding="{Binding Availability, Converter={StaticResource ObjectNotNullConverter}}" Value="True"/>
                                        <BindingCondition Binding="{Binding Availability.IsFull}" Value="True"/>
                                    </MultiTrigger.Conditions>
                                    <Setter Property="BackgroundColor" Value="#9CA3AF"/>
                                    <Setter Property="IsEnabled" Value="False"/>
                                </MultiTrigger>
                                <MultiTrigger TargetType="Border">
                                    <MultiTrigger.Conditions>
                                        <BindingCondition Binding="{Binding IsBooking}" Value="True"/>
                                    </MultiTrigger.Conditions>
                                    <Setter Property="BackgroundColor" Value="#9CA3AF"/>
                                    <Setter Property="IsEnabled" Value="False"/>
                                </MultiTrigger>
                            </Border.Triggers>
                        </Border>

                    </VerticalStackLayout>

                </VerticalStackLayout>

            </VerticalStackLayout>

        </VerticalStackLayout>
    </ScrollView>
</ContentPage>