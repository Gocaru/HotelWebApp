<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:HotelWebApp.Mobile.ViewModels"
             xmlns:converters="clr-namespace:HotelWebApp.Mobile.Converters"
             x:Class="HotelWebApp.Mobile.Views.ChangePasswordPage"
             x:DataType="vm:ChangePasswordViewModel"
             Title="Change Password">

    <ContentPage.Resources>
        <converters:InvertedBoolConverter x:Key="InvertedBoolConverter" />
    </ContentPage.Resources>

    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="20">

            <!-- Header -->
            <VerticalStackLayout Spacing="10" Margin="0,20,0,30">
                <Label Text="ðŸ”"
                       FontSize="48"
                       HorizontalOptions="Center" />
                <Label Text="Change Your Password"
                       FontSize="24"
                       FontAttributes="Bold"
                       HorizontalTextAlignment="Center"
                       TextColor="{AppThemeBinding Light=#1F1F1F, Dark=White}" />
                <Label Text="Enter your current password and choose a new one"
                       FontSize="14"
                       HorizontalTextAlignment="Center"
                       TextColor="{AppThemeBinding Light={StaticResource Gray600}, Dark={StaticResource Gray300}}" />
            </VerticalStackLayout>

            <!-- Current Password -->
            <Frame CornerRadius="10"
                   Padding="0"
                   HasShadow="False"
                   BorderColor="{AppThemeBinding Light=#E5E7EB, Dark=#374151}"
                   BackgroundColor="{AppThemeBinding Light=White, Dark=#1F1F1F}">
                <VerticalStackLayout Padding="15" Spacing="5">
                    <Label Text="Current Password"
                           FontSize="12"
                           FontAttributes="Bold"
                           TextColor="{AppThemeBinding Light={StaticResource Gray600}, Dark={StaticResource Gray300}}" />

                    <Grid ColumnDefinitions="*,Auto">
                        <Entry Grid.Column="0"
                               Text="{Binding CurrentPassword}"
                               Placeholder="Enter current password"
                               IsPassword="{Binding ShowCurrentPassword, Converter={StaticResource InvertedBoolConverter}}"
                               FontSize="16"
                               TextColor="{AppThemeBinding Light=#1F1F1F, Dark=White}"
                               PlaceholderColor="{AppThemeBinding Light={StaticResource Gray400}, Dark={StaticResource Gray500}}"
                               BackgroundColor="Transparent" />

                        <Button Grid.Column="1"
                                Text="{Binding ShowCurrentPassword, Converter={StaticResource InvertedBoolConverter}}"
                                Command="{Binding ToggleCurrentPasswordVisibilityCommand}"
                                BackgroundColor="Transparent"
                                TextColor="{StaticResource Primary}"
                                FontSize="20"
                                WidthRequest="40"
                                HeightRequest="40"
                                Padding="0">
                            <Button.Triggers>
                                <DataTrigger TargetType="Button" 
                                           Binding="{Binding ShowCurrentPassword}" 
                                           Value="False">
                                    <Setter Property="Text" Value="ðŸ‘ï¸" />
                                </DataTrigger>
                                <DataTrigger TargetType="Button" 
                                           Binding="{Binding ShowCurrentPassword}" 
                                           Value="True">
                                    <Setter Property="Text" Value="ðŸ™ˆ" />
                                </DataTrigger>
                            </Button.Triggers>
                        </Button>
                    </Grid>
                </VerticalStackLayout>
            </Frame>

            <!-- New Password -->
            <Frame CornerRadius="10"
                   Padding="0"
                   HasShadow="False"
                   BorderColor="{AppThemeBinding Light=#E5E7EB, Dark=#374151}"
                   BackgroundColor="{AppThemeBinding Light=White, Dark=#1F1F1F}">
                <VerticalStackLayout Padding="15" Spacing="5">
                    <Label Text="New Password"
                           FontSize="12"
                           FontAttributes="Bold"
                           TextColor="{AppThemeBinding Light={StaticResource Gray600}, Dark={StaticResource Gray300}}" />

                    <Grid ColumnDefinitions="*,Auto">
                        <Entry Grid.Column="0"
                               Text="{Binding NewPassword}"
                               Placeholder="Enter new password (min. 6 characters)"
                               IsPassword="{Binding ShowNewPassword, Converter={StaticResource InvertedBoolConverter}}"
                               FontSize="16"
                               TextColor="{AppThemeBinding Light=#1F1F1F, Dark=White}"
                               PlaceholderColor="{AppThemeBinding Light={StaticResource Gray400}, Dark={StaticResource Gray500}}"
                               BackgroundColor="Transparent" />

                        <Button Grid.Column="1"
                                Command="{Binding ToggleNewPasswordVisibilityCommand}"
                                BackgroundColor="Transparent"
                                TextColor="{StaticResource Primary}"
                                FontSize="20"
                                WidthRequest="40"
                                HeightRequest="40"
                                Padding="0">
                            <Button.Triggers>
                                <DataTrigger TargetType="Button" 
                                           Binding="{Binding ShowNewPassword}" 
                                           Value="False">
                                    <Setter Property="Text" Value="ðŸ‘ï¸" />
                                </DataTrigger>
                                <DataTrigger TargetType="Button" 
                                           Binding="{Binding ShowNewPassword}" 
                                           Value="True">
                                    <Setter Property="Text" Value="ðŸ™ˆ" />
                                </DataTrigger>
                            </Button.Triggers>
                        </Button>
                    </Grid>
                </VerticalStackLayout>
            </Frame>

            <!-- Confirm Password -->
            <Frame CornerRadius="10"
                   Padding="0"
                   HasShadow="False"
                   BorderColor="{AppThemeBinding Light=#E5E7EB, Dark=#374151}"
                   BackgroundColor="{AppThemeBinding Light=White, Dark=#1F1F1F}">
                <VerticalStackLayout Padding="15" Spacing="5">
                    <Label Text="Confirm New Password"
                           FontSize="12"
                           FontAttributes="Bold"
                           TextColor="{AppThemeBinding Light={StaticResource Gray600}, Dark={StaticResource Gray300}}" />

                    <Grid ColumnDefinitions="*,Auto">
                        <Entry Grid.Column="0"
                               Text="{Binding ConfirmPassword}"
                               Placeholder="Confirm new password"
                               IsPassword="{Binding ShowConfirmPassword, Converter={StaticResource InvertedBoolConverter}}"
                               FontSize="16"
                               TextColor="{AppThemeBinding Light=#1F1F1F, Dark=White}"
                               PlaceholderColor="{AppThemeBinding Light={StaticResource Gray400}, Dark={StaticResource Gray500}}"
                               BackgroundColor="Transparent" />

                        <Button Grid.Column="1"
                                Command="{Binding ToggleConfirmPasswordVisibilityCommand}"
                                BackgroundColor="Transparent"
                                TextColor="{StaticResource Primary}"
                                FontSize="20"
                                WidthRequest="40"
                                HeightRequest="40"
                                Padding="0">
                            <Button.Triggers>
                                <DataTrigger TargetType="Button" 
                                           Binding="{Binding ShowConfirmPassword}" 
                                           Value="False">
                                    <Setter Property="Text" Value="ðŸ‘ï¸" />
                                </DataTrigger>
                                <DataTrigger TargetType="Button" 
                                           Binding="{Binding ShowConfirmPassword}" 
                                           Value="True">
                                    <Setter Property="Text" Value="ðŸ™ˆ" />
                                </DataTrigger>
                            </Button.Triggers>
                        </Button>
                    </Grid>
                </VerticalStackLayout>
            </Frame>

            <!-- Password Requirements -->
            <Frame CornerRadius="10"
                   Padding="15"
                   HasShadow="False"
                   BorderColor="Transparent"
                   BackgroundColor="{AppThemeBinding Light=#EFF6FF, Dark=#1E3A8A}">
                <VerticalStackLayout Spacing="8">
                    <Label Text="Password Requirements:"
                           FontSize="12"
                           FontAttributes="Bold"
                           TextColor="{AppThemeBinding Light=#1E3A8A, Dark=#DBEAFE}" />
                    <Label Text="â€¢ At least 6 characters"
                           FontSize="12"
                           TextColor="{AppThemeBinding Light=#1E3A8A, Dark=#DBEAFE}" />
                    <Label Text="â€¢ Different from current password"
                           FontSize="12"
                           TextColor="{AppThemeBinding Light=#1E3A8A, Dark=#DBEAFE}" />
                </VerticalStackLayout>
            </Frame>

            <!-- Buttons -->
            <VerticalStackLayout Spacing="10" Margin="0,10,0,0">
                <Button Text="Change Password"
                        Command="{Binding ChangePasswordCommand}"
                        BackgroundColor="{StaticResource Primary}"
                        TextColor="White"
                        CornerRadius="10"
                        HeightRequest="50"
                        FontAttributes="Bold"
                        IsEnabled="{Binding IsBusy, Converter={StaticResource InvertedBoolConverter}}" />

                <Button Text="Cancel"
                        Command="{Binding CancelCommand}"
                        BackgroundColor="Transparent"
                        TextColor="{AppThemeBinding Light={StaticResource Gray600}, Dark={StaticResource Gray300}}"
                        BorderColor="{AppThemeBinding Light=#E5E7EB, Dark=#374151}"
                        BorderWidth="1"
                        CornerRadius="10"
                        HeightRequest="50"
                        IsEnabled="{Binding IsBusy, Converter={StaticResource InvertedBoolConverter}}" />
            </VerticalStackLayout>

            <!-- Loading Indicator -->
            <ActivityIndicator IsRunning="{Binding IsBusy}"
                             IsVisible="{Binding IsBusy}"
                             Color="{StaticResource Primary}"
                             VerticalOptions="Center"
                             HeightRequest="50"
                             Margin="0,20,0,0" />

        </VerticalStackLayout>
    </ScrollView>

</ContentPage>