<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:HotelWebApp.Mobile.ViewModels"
             x:Class="HotelWebApp.Mobile.Views.ReservationDetailPage"
             x:DataType="viewmodels:ReservationDetailViewModel"
             Shell.NavBarIsVisible="True"
             Title="Reservation Details"
             BackgroundColor="{AppThemeBinding Light=White, Dark=#121212}">

    <ScrollView>
        <VerticalStackLayout Spacing="0">

            <!-- HERO SECTION WITH IMAGE BACKGROUND -->
            <Grid RowDefinitions="200">
                <!-- Background Image -->
                <Image Source="hotel_lobby.jpg"
                       Aspect="AspectFill"/>

                <!-- White Overlay -->
                <BoxView BackgroundColor="White"
                         Opacity="0.70"/>

                <!-- Content -->
                <VerticalStackLayout VerticalOptions="Center" 
                                     Spacing="10"
                                     Padding="40,0"
                                     IsVisible="{Binding Reservation, Converter={StaticResource ObjectNotNullConverter}}">

                    <Label Text="{Binding Reservation.RoomNumber, StringFormat='Room {0}'}"
                           FontSize="28"
                           FontAttributes="Bold"
                           TextColor="#1E3A8A"
                           HorizontalTextAlignment="Center"
                           LineHeight="1.2"/>

                    <Label Text="{Binding Reservation.RoomType}"
                           FontSize="16"
                           FontAttributes="Bold"
                           TextColor="#6B7280"
                           HorizontalTextAlignment="Center"/>

                </VerticalStackLayout>
            </Grid>

            <!-- CONTENT -->
            <VerticalStackLayout Padding="40,30"
                                 Spacing="25">

                <!-- Loading Indicator -->
                <ActivityIndicator IsRunning="{Binding IsBusy}"
                                   IsVisible="{Binding IsBusy}"
                                   Color="#1E3A8A"
                                   HeightRequest="50"/>

                <!-- Error Message -->
                <Frame IsVisible="{Binding ErrorMessage, Converter={StaticResource StringNotEmptyConverter}}"
                       BackgroundColor="#FEE2E2"
                       BorderColor="#EF4444"
                       CornerRadius="12"
                       Padding="20"
                       HasShadow="False">
                    <Label Text="{Binding ErrorMessage}"
                           TextColor="#991B1B"
                           FontSize="14"
                           LineHeight="1.5"/>
                </Frame>

                <!-- Reservation Content -->
                <VerticalStackLayout IsVisible="{Binding Reservation, Converter={StaticResource ObjectNotNullConverter}}"
                                     Spacing="30">

                    <!-- Status and Price -->
                    <Grid ColumnDefinitions="Auto,*">
                        <Border Grid.Column="0"
                                StrokeThickness="0"
                                StrokeShape="RoundRectangle 8"
                                Padding="12,8"
                                BackgroundColor="{Binding Reservation.StatusColor}"
                                VerticalOptions="Center">
                            <Label Text="{Binding Reservation.Status}"
                                   TextColor="White"
                                   FontSize="13"
                                   FontAttributes="Bold"/>
                        </Border>

                        <Label Grid.Column="1"
                               Text="{Binding Reservation.PriceFormatted}"
                               FontSize="28"
                               FontAttributes="Bold"
                               TextColor="{AppThemeBinding Light=#1E3A8A, Dark=#60A5FA}"
                               HorizontalOptions="End"
                               VerticalOptions="Center"/>
                    </Grid>

                    <!-- Stay Duration -->
                    <VerticalStackLayout Spacing="15">
                        <Label Text="Stay Duration"
                               FontSize="20"
                               FontAttributes="Bold"
                               TextColor="{AppThemeBinding Light=#1E3A8A, Dark=#60A5FA}"/>

                        <Grid ColumnDefinitions="*,Auto,*" 
                              ColumnSpacing="15">

                            <!-- Check-in -->
                            <Border Grid.Column="0"
                                    StrokeThickness="1"
                                    Stroke="{AppThemeBinding Light=#E5E7EB, Dark=#374151}"
                                    StrokeShape="RoundRectangle 12"
                                    Padding="16"
                                    BackgroundColor="{AppThemeBinding Light=#F9FAFB, Dark=#1F2937}">
                                <VerticalStackLayout Spacing="6">
                                    <Label Text="Check-in"
                                           FontSize="12"
                                           FontAttributes="Bold"
                                           TextColor="{AppThemeBinding Light=#6B7280, Dark=#9CA3AF}"/>
                                    <Label Text="{Binding Reservation.CheckInFormatted}"
                                           FontSize="15"
                                           FontAttributes="Bold"
                                           TextColor="{AppThemeBinding Light=#1F2937, Dark=#E5E7EB}"/>
                                </VerticalStackLayout>
                            </Border>

                            <Label Grid.Column="1"
                                   Text="â†’"
                                   FontSize="24"
                                   TextColor="{AppThemeBinding Light=#9CA3AF, Dark=#6B7280}"
                                   VerticalOptions="Center"/>

                            <!-- Check-out -->
                            <Border Grid.Column="2"
                                    StrokeThickness="1"
                                    Stroke="{AppThemeBinding Light=#E5E7EB, Dark=#374151}"
                                    StrokeShape="RoundRectangle 12"
                                    Padding="16"
                                    BackgroundColor="{AppThemeBinding Light=#F9FAFB, Dark=#1F2937}">
                                <VerticalStackLayout Spacing="6">
                                    <Label Text="Check-out"
                                           FontSize="12"
                                           FontAttributes="Bold"
                                           TextColor="{AppThemeBinding Light=#6B7280, Dark=#9CA3AF}"/>
                                    <Label Text="{Binding Reservation.CheckOutFormatted}"
                                           FontSize="15"
                                           FontAttributes="Bold"
                                           TextColor="{AppThemeBinding Light=#1F2937, Dark=#E5E7EB}"/>
                                </VerticalStackLayout>
                            </Border>
                        </Grid>

                        <Label Text="{Binding Reservation.NumberOfNights, StringFormat='{0} night(s)'}"
                               FontSize="14"
                               TextColor="{AppThemeBinding Light=#6B7280, Dark=#9CA3AF}"
                               HorizontalTextAlignment="Center"
                               Margin="0,5,0,0"/>
                    </VerticalStackLayout>

                    <!-- Divider -->
                    <BoxView HeightRequest="1"
                             Color="{AppThemeBinding Light=#E5E7EB, Dark=#374151}"/>

                    <!-- Reservation Information -->
                    <VerticalStackLayout Spacing="15">
                        <Label Text="Reservation Information"
                               FontSize="20"
                               FontAttributes="Bold"
                               TextColor="{AppThemeBinding Light=#1E3A8A, Dark=#60A5FA}"/>

                        <!-- Number of Guests -->
                        <Grid ColumnDefinitions="*,Auto">
                            <Label Grid.Column="0"
                                   Text="Number of Guests"
                                   FontSize="15"
                                   TextColor="{AppThemeBinding Light=#6B7280, Dark=#9CA3AF}"
                                   VerticalOptions="Center"/>
                            <Label Grid.Column="1"
                                   Text="{Binding Reservation.NumberOfGuests}"
                                   FontSize="16"
                                   FontAttributes="Bold"
                                   TextColor="{AppThemeBinding Light=#1F2937, Dark=#E5E7EB}"
                                   VerticalOptions="Center"/>
                        </Grid>

                        <!-- Reservation Date -->
                        <Grid ColumnDefinitions="*,Auto">
                            <Label Grid.Column="0"
                                   Text="Reservation Date"
                                   FontSize="15"
                                   TextColor="{AppThemeBinding Light=#6B7280, Dark=#9CA3AF}"
                                   VerticalOptions="Center"/>
                            <Label Grid.Column="1"
                                   Text="{Binding Reservation.ReservationDate, StringFormat='{0:dd MMM yyyy}'}"
                                   FontSize="16"
                                   FontAttributes="Bold"
                                   TextColor="{AppThemeBinding Light=#1F2937, Dark=#E5E7EB}"
                                   VerticalOptions="Center"/>
                        </Grid>
                    </VerticalStackLayout>

                    <!-- Action Buttons -->
                    <VerticalStackLayout Spacing="15" Margin="0,10,0,20">

                        <!-- Check-In Button -->
                        <Border StrokeThickness="0"
                                StrokeShape="RoundRectangle 12"
                                Padding="0"
                                HeightRequest="56"
                                BackgroundColor="#10B981"
                                IsVisible="{Binding Reservation.CanCheckIn}">
                            <Border.Shadow>
                                <Shadow Brush="Black" Opacity="0.1" Radius="8" Offset="0,2"/>
                            </Border.Shadow>
                            <Border.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding CheckInCommand}"/>
                            </Border.GestureRecognizers>
                            <Label Text="Check-In Now"
                                   FontSize="16"
                                   FontAttributes="Bold"
                                   TextColor="White"
                                   HorizontalTextAlignment="Center"
                                   VerticalTextAlignment="Center"/>
                        </Border>

                        <!-- Cancel Button -->
                        <Border StrokeThickness="2"
                                Stroke="#EF4444"
                                StrokeShape="RoundRectangle 12"
                                Padding="0"
                                HeightRequest="56"
                                BackgroundColor="Transparent"
                                IsVisible="{Binding Reservation.CanCancel}">
                            <Border.Shadow>
                                <Shadow Brush="Black" Opacity="0.05" Radius="8" Offset="0,2"/>
                            </Border.Shadow>
                            <Border.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding CancelReservationCommand}"/>
                            </Border.GestureRecognizers>
                            <Label Text="Cancel Reservation"
                                   FontSize="16"
                                   FontAttributes="Bold"
                                   TextColor="#EF4444"
                                   HorizontalTextAlignment="Center"
                                   VerticalTextAlignment="Center"/>
                        </Border>
                    </VerticalStackLayout>

                </VerticalStackLayout>

            </VerticalStackLayout>

        </VerticalStackLayout>
    </ScrollView>
</ContentPage>