@model IEnumerable<HotelWebApp.Models.ReservationListViewModel>
@using HotelWebApp.Data.Entities

@{
    ViewData["Title"] = "Reservations Management";
}

<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h1 class="mb-0">@ViewData["Title"]</h1>
            <p class="text-muted">View, create, and manage all hotel reservations.</p>
        </div>
    </div>

@if (TempData["SuccessMessage"] != null)
{
        <div class="alert alert-success">@TempData["SuccessMessage"]</div>
}
@if (TempData["ErrorMessage"] != null)
{
        <div class="alert alert-danger">@TempData["ErrorMessage"]</div>
}

<script id="statusTemplate" type="text/x-template">
        ${if(IsOverdue)}
            <span class="badge bg-danger">Overdue</span>
        ${else}
            <span class="badge ${StatusBadgeClass}">${StatusText}</span>
        ${/if}
</script>

    <script id="actionsTemplate" type="text/x-template">
        <div>
            ${if(CanCheckIn)}
                <form action="/Reservations/CheckIn/${Id}" method="post" class="d-inline">
                    @Html.AntiForgeryToken()
                    <button type="submit" class="btn btn-success btn-sm" title="Check-in"><i class="fas fa-sign-in-alt"></i></button>
                </form>
            ${/if}

            ${if(CanCheckOut)}
                <form action="/Reservations/CheckOut/${Id}" method="post" class="d-inline">
                     @Html.AntiForgeryToken()
                    ${if(IsOverdue)}
                        <button type="submit" class="btn btn-danger btn-sm" title="Process Overdue Check-out">
                            <i class="fas fa-exclamation-triangle"></i>
                        </button>
                    ${else}
                        <button type="submit" class="btn btn-primary btn-sm" title="Check-out">
                            <i class="fas fa-sign-out-alt"></i>
                        </button>
                    ${/if}
                </form>
            ${/if}

            ${if(StatusText == 'CheckedOut' || StatusText == 'Completed' || StatusText == 'NoShow')}
                <a href="/Invoices/Details?reservationId=${Id}" class="btn btn-secondary btn-sm" title="View Invoice">
                    <i class="fas fa-file-invoice-dollar"></i>
                </a>
            ${/if}

            ${if(CanEdit)}
                <a href="/Reservations/Edit/${Id}" class="btn btn-warning btn-sm" title="Edit"><i class="fas fa-edit"></i></a>
            ${/if}

            <a href="/Reservations/Details/${Id}" class="btn btn-info btn-sm" title="Details"><i class="fas fa-info-circle"></i></a>

            ${if(CanDelete)}
                <a href="/Reservations/Delete/${Id}" class="btn btn-danger btn-sm" title="Delete"><i class="fas fa-trash"></i></a>
            ${/if}
        </div>
    </script>


<div class="alert alert-light border-0 shadow-sm mb-3">
    <h6 class="alert-heading"><i class="fas fa-info-circle"></i> Actions Legend</h6>
    <hr>
    <div class="d-flex flex-wrap">
        <span class="me-4"><button class="btn btn-sm btn-success disabled"><i class="fas fa-sign-in-alt"></i></button> Check-in</span>
        <span class="me-4"><button class="btn btn-sm btn-primary disabled"><i class="fas fa-sign-out-alt"></i></button> Check-out</span>
        <span class="me-4"><button class="btn btn-sm btn-warning disabled"><i class="fas fa-edit"></i></button> Edit</span>
        <span class="me-4"><button class="btn btn-sm btn-info disabled"><i class="fas fa-info-circle"></i></button> Details</span>
        <span class="me-4"><button class="btn btn-sm btn-danger disabled"><i class="fas fa-trash"></i></button> Delete</span>
        <span class="me-4"><button class="btn btn-sm btn-secondary disabled"><i class="fas fa-file-invoice-dollar"></i></button> View Invoice</span>
    </div>
</div>

<ejs-grid id="reservationsGrid"
          dataSource="@Model"
          allowPaging="true"
          allowSorting="true"
          toolbar="@(new List<string>() { "Add", "Search" })"
          toolbarClick="toolbarClickHandler">

    <e-grid-editSettings allowAdding="true"></e-grid-editSettings>
    <e-grid-pagesettings pageSize="7"></e-grid-pagesettings>
    <e-grid-columns>
        <e-grid-column field="Id" isPrimaryKey="true" visible="false"></e-grid-column>
        <e-grid-column field="GuestDetails" headerText="Guest (Pax)" width="180"></e-grid-column>
        <e-grid-column field="RoomDetails" headerText="Room" width="140"></e-grid-column>
        <e-grid-column field="CheckInDate" headerText="Check-in" format="dd/MM/yyyy" type="date" width="110"></e-grid-column>
        <e-grid-column field="CheckOutDate" headerText="Check-out" format="dd/MM/yyyy" type="date" width="110"></e-grid-column>
        <e-grid-column headerText="Status" template="#statusTemplate" width="120" textAlign="Center"></e-grid-column>
        <e-grid-column field="TotalCost" headerText="Total" format="C2" textAlign="Right" width="120"></e-grid-column>
        <e-grid-column headerText="Actions" template="#actionsTemplate" width="150" textAlign="Center"></e-grid-column>
    </e-grid-columns>
</ejs-grid>

@section Scripts {
    <script>
        function toolbarClickHandler(args) {
            if (args.item.id === 'reservationsGrid_add') {
                args.cancel = true;
                window.location.href = '@Url.Action("Create", "Reservations")';
            }
        }

    </script>
}
</div>
