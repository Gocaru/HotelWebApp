@model IEnumerable<HotelWebApp.Models.ReservationListViewModel>
@using HotelWebApp.Data.Entities

@{
    ViewData["Title"] = "Reservations Management";
}

<h1>@ViewData["Title"]</h1>

@if (User.IsInRole("Employee"))
{
    <p>
        <a asp-action="Create" class="btn btn-primary mb-3">Create New Reservation</a>
    </p>
}

@if (TempData["SuccessMessage"] != null)
{
    <div class="alert alert-success">@TempData["SuccessMessage"]</div>
}
@if (TempData["ErrorMessage"] != null)
{
    <div class="alert alert-danger">@TempData["ErrorMessage"]</div>
}

<!-- PASSO 1: DEFINIÇÃO DOS TEMPLATES FORA DO GRID -->
<script id="statusTemplate" type="text/x-template">
    <span class="badge ${StatusBadgeClass}">${StatusText}</span>
</script>

<script id="actionsTemplate" type="text/x-template">
    <div>
        ${if(CanCheckIn)}
            <form action="/Reservations/CheckIn/${Id}" method="post" class="d-inline">
                @Html.AntiForgeryToken()
                <button type="submit" class="btn btn-success btn-sm" title="Check-in"><i class="fas fa-sign-in-alt"></i></button>
            </form>
        ${/if}

        ${if(CanCheckOut)}
            <form action="/Reservations/CheckOut/${Id}" method="post" class="d-inline">
                @Html.AntiForgeryToken()
                <button type="submit" class="btn btn-primary btn-sm" title="Check-out"><i class="fas fa-sign-out-alt"></i></button>
            </form>
        ${/if}

        ${if(CanEdit)}
            <a href="/Reservations/Edit/${Id}" class="btn btn-warning btn-sm" title="Edit"><i class="fas fa-edit"></i></a>
        ${/if}

        <a href="/Reservations/Details/${Id}" class="btn btn-info btn-sm" title="Details"><i class="fas fa-info-circle"></i></a>

        ${if(CanDelete)}
            <a href="/Reservations/Delete/${Id}" class="btn btn-danger btn-sm" title="Delete"><i class="fas fa-trash"></i></a>
        ${/if}
    </div>
</script>

<!-- PASSO 2: O GRID QUE USA OS TEMPLATES POR ID -->
<ejs-grid id="reservationsGrid"
          dataSource="@Model"
          allowPaging="true"
          allowSorting="true"
          toolbar="@(new List<string>() { "Search" })"
          height="500">
    <e-grid-columns>
        <e-grid-column field="Id" isPrimaryKey="true" visible="false"></e-grid-column>
        <e-grid-column field="GuestName" headerText="Guest" width="180"></e-grid-column>
        <e-grid-column field="RoomNumber" headerText="Room" width="100" textAlign="Right"></e-grid-column>
        <e-grid-column field="CheckInDate" headerText="Check-in Date" format="dd/MM/yyyy" type="date" width="140"></e-grid-column>
        <e-grid-column field="CheckOutDate" headerText="Check-out Date" format="dd/MM/yyyy" type="date" width="140"></e-grid-column>

        <e-grid-column headerText="Status" template="#statusTemplate" width="130" textAlign="Center"></e-grid-column>

        <e-grid-column field="NumberOfGuests" headerText="Number of guests" textAlign="Right" width="120"></e-grid-column>

        <e-grid-column field="RoomDetails" headerText="Room" width="150"></e-grid-column>

        <e-grid-column field="TotalCost" headerText="Total Cost" format="C2" textAlign="Right" width="130"></e-grid-column>

        <e-grid-column headerText="Actions" template="#actionsTemplate" width="280" textAlign="Center"></e-grid-column>
    </e-grid-columns>
</ejs-grid>
